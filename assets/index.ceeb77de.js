import{z as e,bC as t,j as n,Z as i,D as s,F as a,w as o,a2 as r,a4 as l,a7 as c,ao as m,a0 as u,aA as d,N as g,r as p,ai as f,u as v,bP as w,a9 as h,bR as b,bS as L,aM as x}from"./vendor.586ef38d.js";/* empty css              */import{p as I,c as S,j as _,aW as y}from"./index.8b600a06.js";import{P as C}from"./index.c05e4b18.js";/* empty css              *//* empty css              */import"./onMountedOrActivated.91bbfd98.js";import"./useWindowSizeFn.58b367db.js";import"./useContentViewHeight.83011d32.js";var k=e({name:"ImagePreview",components:{Image:t,PreviewGroup:t.PreviewGroup},props:{functional:I.bool,imageList:{type:Array}},setup(e){const{prefixCls:t}=S("image-preview");return{prefixCls:t,getImageList:n((()=>{const{imageList:t}=e;return t?t.map((e=>_(e)?{src:e,placeholder:!1}:e)):[]}))}}});k.render=function(e,t,n,g,p,f){const v=i("Image"),w=i("PreviewGroup");return s(),a("div",{class:e.prefixCls},[o(w,null,{default:r((()=>[!e.imageList||e.$slots.default?l(e.$slots,"default",{key:0}):(s(!0),a(c,{key:1},m(e.getImageList,(e=>(s(),a(v,u({key:e.src},e),d({_:2},[e.placeholder?{name:"placeholder",fn:r((()=>[o(v,u(e,{src:e.placeholder,preview:!1}),null,16,["src"])]))}:void 0]),1040)))),128))])),_:3})],2)};var D,P;(P=D||(D={}))[P.LOADING=0]="LOADING",P[P.DONE=1]="DONE",P[P.FAIL=2]="FAIL";const W={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},j="img-preview";var N=e({name:"ImagePreview",props:W,emits:["img-load","img-error"],setup(e,{expose:t,emit:i}){const s=new Map,a=g({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:D.LOADING,currentIndex:0,moveX:0,moveY:0,show:e.show}),r=p(null),l=p(null);function c(){!function(){const e=v(r);if(!e)return;e.onmousewheel=d,document.body.addEventListener("DOMMouseScroll",d),document.ondragstart=function(){return!1}}();const{index:t,imageList:n}=e;if(!n||!n.length)throw new Error("imageList is undefined");a.currentIndex=t,_(n[t])}function m(){a.imgScale=1,a.imgRotate=0,a.imgTop=0,a.imgLeft=0}const u=n((()=>e.scaleStep>0&&e.scaleStep<100?e.scaleStep/100:a.imgScale/10));function d(e){(e=e||window.event).delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&x(u.value),e.delta<0&&x(-u.value)}function x(e){a.imgScale<=.2&&e<0||(a.imgScale+=e)}function I(e){a.imgRotate+=e}function S(){const e=v(l);e&&(e.onmousemove=null)}function _(t){a.status=D.LOADING;const n=new Image;n.src=t,n.onload=n=>{if(a.currentUrl!==t){const o=n.composedPath();if(e.rememberState){s.set(a.currentUrl,{scale:a.imgScale,top:a.imgTop,left:a.imgLeft,rotate:a.imgRotate});const n=s.get(t);n?(a.imgScale=n.scale,a.imgTop=n.top,a.imgRotate=n.rotate,a.imgLeft=n.left):(m(),e.defaultWidth&&(a.imgScale=e.defaultWidth/o[0].naturalWidth))}else e.defaultWidth&&(a.imgScale=e.defaultWidth/o[0].naturalWidth);o&&i("img-load",{index:a.currentIndex,dom:o[0],url:t})}a.currentUrl=t,a.status=D.DONE},n.onerror=e=>{const n=e.composedPath();n&&i("img-error",{index:a.currentIndex,dom:n[0],url:t}),a.status=D.FAIL}}function y(e){e&&e.stopPropagation(),C()}function C(){a.show=!1,document.body.removeEventListener("DOMMouseScroll",d),document.ondragstart=null}function k(){m()}function P(t){const{currentIndex:n}=a,{imageList:i}=e;"left"===t&&(a.currentIndex--,n<=0&&(a.currentIndex=i.length-1)),"right"===t&&(a.currentIndex++,n>=i.length-1&&(a.currentIndex=0)),_(i[a.currentIndex])}function W(e){e=e||window.event,a.moveX=e.clientX,a.moveY=e.clientY;const t=v(l);t&&(t.onmousemove=N)}function N(e){(e=e||window.event).preventDefault();const t=e.clientX-a.moveX,n=e.clientY-a.moveY;a.imgLeft+=t,a.imgTop+=n,a.moveX=e.clientX,a.moveY=e.clientY}t({resume:k,close:C,prev:P.bind(null,"left"),next:P.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(a.imgScale=e)},setRotate:e=>{a.imgRotate=e}});const O=n((()=>{const{imgScale:t,imgRotate:n,imgTop:i,imgLeft:s}=a;return{transform:`scale(${t}) rotate(${n}deg)`,marginTop:`${i}px`,marginLeft:`${s}px`,maxWidth:e.defaultWidth?"unset":"100%"}})),A=n((()=>{const{imageList:t}=e;return t.length>1}));f((()=>{e.show&&c(),e.imageList&&m()}));const M=t=>{e.maskClosable&&t.target&&t.target.classList.contains("img-preview-content")&&y(t)},R=()=>{if(!v(A))return null;const{currentIndex:t}=a,{imageList:n}=e;return o("div",{class:"img-preview__index"},[t+1,h(" / "),n.length])},E=e=>v(A)?o("div",{class:["img-preview__arrow",e],onClick:()=>P(e)},[o("left"===e?b:L,null,null)]):null;return()=>a.show&&o("div",{class:j,ref:r,onMouseup:S,onClick:M},[o("div",{class:"img-preview-content"},[o("img",{style:v(O),class:["img-preview-image",a.status===D.DONE?"":"hidden"],ref:l,src:a.currentUrl,onMousedown:W},null),o("div",{class:"img-preview__close",onClick:y},[o(w,{class:"img-preview__close-icon"},null)]),R(),o("div",{class:"img-preview__controller"},[o("div",{class:"img-preview__controller-item",onClick:()=>x(-u.value)},[o("img",{src:"/banquet-admin/assets/unscale.c552f416.svg"},null)]),o("div",{class:"img-preview__controller-item",onClick:()=>x(u.value)},[o("img",{src:"/banquet-admin/assets/scale.44abde22.svg"},null)]),o("div",{class:"img-preview__controller-item",onClick:k},[o("img",{src:"/banquet-admin/assets/resume.8f27866b.svg"},null)]),o("div",{class:"img-preview__controller-item",onClick:()=>I(-90)},[o("img",{src:"/banquet-admin/assets/unrotate.ef6a2daf.svg"},null)]),o("div",{class:"img-preview__controller-item",onClick:()=>I(90)},[o("img",{src:"/banquet-admin/assets/p-rotate.cb8bbfc3.svg"},null)])]),E("left"),E("right")])])}});let O=null;const A=["https://picsum.photos/id/66/346/216","https://picsum.photos/id/67/346/216","https://picsum.photos/id/68/346/216"];var M=e({components:{PageWrapper:C,ImagePreview:k},setup:()=>({imgList:A,openImg:function(){!function(e){var t;if(!y)return;const n={},i=document.createElement("div");Object.assign(n,{show:!0,index:0,scaleStep:100},e),O=o(N,n),x(O,i),document.body.appendChild(i),null==(t=O.component)||t.exposed}({imageList:A,defaultWidth:700,rememberState:!0,onImgLoad:({index:e,url:t,dom:n})=>{}})}})});const R=h("无预览图");M.render=function(e,t,n,l,c,m){const u=i("ImagePreview"),d=i("a-button"),g=i("PageWrapper");return s(),a(g,{title:"图片预览示例"},{default:r((()=>[o(u,{imageList:e.imgList},null,8,["imageList"]),o(d,{onClick:e.openImg,type:"primary"},{default:r((()=>[R])),_:1},8,["onClick"])])),_:1})};export{M as default};
