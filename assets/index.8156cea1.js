import{A as e,bu as t,j as n,_ as i,L as s,F as o,x as a,a3 as r,a5 as l,a8 as c,ap as m,a1 as u,aB as d,O as g,r as p,aj as f,u as v,bJ as w,aa as h,bL as L,bM as x,aL as b}from"./vendor.f90788d9.js";/* empty css              */import{p as I,c as _,aj as S,aZ as y}from"./index.27af0dce.js";import{P as C}from"./index.2d7cf9f2.js";/* empty css              *//* empty css              */import"./onMountedOrActivated.a9c9ce1d.js";import"./useWindowSizeFn.206cf3e2.js";import"./useContentViewHeight.f4cabba7.js";var k=e({name:"ImagePreview",components:{Image:t,PreviewGroup:t.PreviewGroup},props:{functional:I.bool,imageList:{type:Array}},setup(e){const{prefixCls:t}=_("image-preview");return{prefixCls:t,getImageList:n((()=>{const{imageList:t}=e;return t?t.map((e=>S(e)?{src:e,placeholder:!1}:e)):[]}))}}});k.render=function(e,t,n,g,p,f){const v=i("Image"),w=i("PreviewGroup");return s(),o("div",{class:e.prefixCls},[a(w,null,{default:r((()=>[!e.imageList||e.$slots.default?l(e.$slots,"default",{key:0}):(s(!0),o(c,{key:1},m(e.getImageList,(e=>(s(),o(v,u({key:e.src},e),d({_:2},[e.placeholder?{name:"placeholder",fn:r((()=>[a(v,u(e,{src:e.placeholder,preview:!1}),null,16,["src"])]))}:void 0]),1040)))),128))])),_:3})],2)};var j,D;(D=j||(j={}))[D.LOADING=0]="LOADING",D[D.DONE=1]="DONE",D[D.FAIL=2]="FAIL";const O={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},P="img-preview";var W=e({name:"ImagePreview",props:O,emits:["img-load","img-error"],setup(e,{expose:t,emit:i}){const s=new Map,o=g({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:j.LOADING,currentIndex:0,moveX:0,moveY:0,show:e.show}),r=p(null),l=p(null);function c(){!function(){const e=v(r);if(!e)return;e.onmousewheel=d,document.body.addEventListener("DOMMouseScroll",d),document.ondragstart=function(){return!1}}();const{index:t,imageList:n}=e;if(!n||!n.length)throw new Error("imageList is undefined");o.currentIndex=t,S(n[t])}function m(){o.imgScale=1,o.imgRotate=0,o.imgTop=0,o.imgLeft=0}const u=n((()=>e.scaleStep>0&&e.scaleStep<100?e.scaleStep/100:o.imgScale/10));function d(e){(e=e||window.event).delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&b(u.value),e.delta<0&&b(-u.value)}function b(e){o.imgScale<=.2&&e<0||(o.imgScale+=e)}function I(e){o.imgRotate+=e}function _(){const e=v(l);e&&(e.onmousemove=null)}function S(t){o.status=j.LOADING;const n=new Image;n.src=t,n.onload=n=>{if(o.currentUrl!==t){const a=n.composedPath();if(e.rememberState){s.set(o.currentUrl,{scale:o.imgScale,top:o.imgTop,left:o.imgLeft,rotate:o.imgRotate});const n=s.get(t);n?(o.imgScale=n.scale,o.imgTop=n.top,o.imgRotate=n.rotate,o.imgLeft=n.left):(m(),e.defaultWidth&&(o.imgScale=e.defaultWidth/a[0].naturalWidth))}else e.defaultWidth&&(o.imgScale=e.defaultWidth/a[0].naturalWidth);a&&i("img-load",{index:o.currentIndex,dom:a[0],url:t})}o.currentUrl=t,o.status=j.DONE},n.onerror=e=>{const n=e.composedPath();n&&i("img-error",{index:o.currentIndex,dom:n[0],url:t}),o.status=j.FAIL}}function y(e){e&&e.stopPropagation(),C()}function C(){o.show=!1,document.body.removeEventListener("DOMMouseScroll",d),document.ondragstart=null}function k(){m()}function D(t){const{currentIndex:n}=o,{imageList:i}=e;"left"===t&&(o.currentIndex--,n<=0&&(o.currentIndex=i.length-1)),"right"===t&&(o.currentIndex++,n>=i.length-1&&(o.currentIndex=0)),S(i[o.currentIndex])}function O(e){e=e||window.event,o.moveX=e.clientX,o.moveY=e.clientY;const t=v(l);t&&(t.onmousemove=W)}function W(e){(e=e||window.event).preventDefault();const t=e.clientX-o.moveX,n=e.clientY-o.moveY;o.imgLeft+=t,o.imgTop+=n,o.moveX=e.clientX,o.moveY=e.clientY}t({resume:k,close:C,prev:D.bind(null,"left"),next:D.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(o.imgScale=e)},setRotate:e=>{o.imgRotate=e}});const A=n((()=>{const{imgScale:t,imgRotate:n,imgTop:i,imgLeft:s}=o;return{transform:`scale(${t}) rotate(${n}deg)`,marginTop:`${i}px`,marginLeft:`${s}px`,maxWidth:e.defaultWidth?"unset":"100%"}})),N=n((()=>{const{imageList:t}=e;return t.length>1}));f((()=>{e.show&&c(),e.imageList&&m()}));const M=t=>{e.maskClosable&&t.target&&t.target.classList.contains("img-preview-content")&&y(t)},E=()=>{if(!v(N))return null;const{currentIndex:t}=o,{imageList:n}=e;return a("div",{class:"img-preview__index"},[t+1,h(" / "),n.length])},R=e=>v(N)?a("div",{class:["img-preview__arrow",e],onClick:()=>D(e)},[a("left"===e?L:x,null,null)]):null;return()=>o.show&&a("div",{class:P,ref:r,onMouseup:_,onClick:M},[a("div",{class:"img-preview-content"},[a("img",{style:v(A),class:["img-preview-image",o.status===j.DONE?"":"hidden"],ref:l,src:o.currentUrl,onMousedown:O},null),a("div",{class:"img-preview__close",onClick:y},[a(w,{class:"img-preview__close-icon"},null)]),E(),a("div",{class:"img-preview__controller"},[a("div",{class:"img-preview__controller-item",onClick:()=>b(-u.value)},[a("img",{src:"/assets/unscale.c552f416.svg"},null)]),a("div",{class:"img-preview__controller-item",onClick:()=>b(u.value)},[a("img",{src:"/assets/scale.44abde22.svg"},null)]),a("div",{class:"img-preview__controller-item",onClick:k},[a("img",{src:"/assets/resume.8f27866b.svg"},null)]),a("div",{class:"img-preview__controller-item",onClick:()=>I(-90)},[a("img",{src:"/assets/unrotate.ef6a2daf.svg"},null)]),a("div",{class:"img-preview__controller-item",onClick:()=>I(90)},[a("img",{src:"/assets/p-rotate.cb8bbfc3.svg"},null)])]),R("left"),R("right")])])}});let A=null;const N=["https://picsum.photos/id/66/346/216","https://picsum.photos/id/67/346/216","https://picsum.photos/id/68/346/216"];var M=e({components:{PageWrapper:C,ImagePreview:k},setup:()=>({imgList:N,openImg:function(){!function(e){var t;if(!y)return;const n={},i=document.createElement("div");Object.assign(n,{show:!0,index:0,scaleStep:100},e),A=a(W,n),b(A,i),document.body.appendChild(i),null==(t=A.component)||t.exposed}({imageList:N,defaultWidth:700,rememberState:!0,onImgLoad:({index:e,url:t,dom:n})=>{}})}})});const E=h("无预览图");M.render=function(e,t,n,l,c,m){const u=i("ImagePreview"),d=i("a-button"),g=i("PageWrapper");return s(),o(g,{title:"图片预览示例"},{default:r((()=>[a(u,{imageList:e.imgList},null,8,["imageList"]),a(d,{onClick:e.openImg,type:"primary"},{default:r((()=>[E])),_:1},8,["onClick"])])),_:1})};export{M as default};
